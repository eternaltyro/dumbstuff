## CONTENT OF THE FILE /opt/logstash/patterns/auditd_patterns
## MODIFIED FROM https://gist.github.com/sakalajuraj/fdafa6dd5819e84c6204

CSV [a-zA-Z0-9_\-,.+]+
## 64 BYTE SERVER FINGERPRINT (OF THE HOST KEY?)
SERVER_FINGERPRINT (?:(?:[A-Fa-f0-9]{2}:){15}[A-Fa-f0-9]{2})

## MESSAGE AUTHENTICATION CODE FORMAT
CRYPTO_MAC (?:%{EMAILADDRESS}|%{USERNAME})

HOSTNAME2 \b(?:[0-9A-Za-z][0-9A-Za-z_-]{0,62})(?:\.(?:[0-9A-Za-z][0-9A-Za-z_-]{0,62}))*(\.?|\b)

AUDITDTRIAL node=%{HOSTNAME2} type=%{WORD:audit_type} msg=audit\(%{NUMBER:audit_epoch}:%{NUMBER:audit_counter}\):
AUDITD_LEADING type=%{WORD:audit_type} msg=audit\(%{NUMBER:audit_epoch}:%{NUMBER:audit_counter}\):

## USER_START, USER_END: TRIGGERED WHEN USER-SPACE SESSION IS INITIATED OR TERMINATED
## USER_ACCT: TRIGGERED WHEN USER-SPACE ACCOUNT IS MODIFIED
## CRED_ACQ, CRED_DISP: TRIGGERED WHEN USER ACQUIRES OR DISPOSES USER-SPACE CREDENTIALS
## CRED_REFR, USER_AUTH, USER_ERR
AUDITD_1 pid=%{INT:audit_pid} uid=%{INT:audit_uid} auid=%{INT:audit_auid} ses=%{INT:audit_ses}( subj=%{DATA:audit_subject})? msg=\'op=%{DATA:audit_op} grantors=%{DATA:audit_grantors} acct=\"(?:\?|%{USER:user})\" exe=\"%{UNIXPATH:audit_exe}\" hostname=(?:\?|%{IPORHOST:audit_hostname}) addr=(?:\?|%{IP:src_ip}) terminal=(?<audit_terminal>%{TTY}|\?|cron) res=%{DATA:audit_res}\'

## LOGIN: TRIGGERED WHEN USER LOGS INTO THE SYSTEM
AUDITD_2 pid=%{NUMBER:audit_pid} uid=%{NUMBER:audit_uid}( subj=%{DATA:audit_subject})? old-auid=%{NUMBER:audit_oldauid} auid=%{NUMBER:audit_auid} old-ses=%{NUMBER:audit_oldses} ses=%{NUMBER:audit_ses} res=%{GREEDYDATA:audit_res}

### SYSCALL
AUDITD_3 arch=%{DATA} syscall=%{NUMBER:audit_syscall} success=%{WORD:audit_success} exit=%{INT:audit_exit} a0=%{WORD:audit_a0} a1=%{WORD:audit_a1} a2=%{WORD:audit_a2} a3=%{WORD:audit_a3} items=%{INT:audit_items} ppid=%{INT:audit_ppid} pid=%{INT:audit_pid} auid=%{INT:audit_auid} uid=%{INT:audit_uid} gid=%{INT:audit_gid} euid=%{INT:audit_euid} suid=%{INT:audit_suid} fsuid=%{INT:audit_fsuid} egid=%{INT:audit_egid} sgid=%{INT:audit_sgid} fsgid=%{INT:audit_fsgid} tty=%{DATA:audit_tty} ses=%{INT:audit_ses} comm=\"%{WORD:audit_comm}\" exe=\"%{DATA:audit_exe}\" subj=%{DATA:audit_subj} key=%{DATA:audit_key}

### NETFILTER_CFG
AUDITD_4 table=%{WORD:audit_table} family=%{INT:audit_family} entries=%{INT:audit_entries}

## CRYPTO_KEY_USER: TRIGGERED TO RECORD THE CRYPTO-KEY IDENTIFIER USED
AUDITD_5 pid=%{NUMBER:audit_pid} uid=%{NUMBER:audit_uid} auid=%{NUMBER:audit_auid} ses=%{NUMBER:audit_ses}( subj=%{DATA:audit_subject})? msg=\'op=%{DATA:audit_op} kind=%{WORD:audit_kind} fp=%{DATA:audit_fp} direction=%{DATA:audit_direction} spid=%{INT:audit_spid} suid=%{INT:audit_suid}( rport=%{INT:src_port} laddr=%{IP:dst_ip} lport=%{INT:dst_port})?\s+exe=\"%{UNIXPATH:audit_exe}\" hostname=(?:\?|%{IPORHOST:audit_hostname}) addr=(?:%{IP:src_ip}|\?) terminal=(?<audit_terminal>%{TTY}|\?|cron) res=%{DATA:audit_res}\'

### AVC
AUDITD_6 avc:\s+%{WORD:audit_avcaction}\s+\{ %{WORD:audit_avcop} \} for\s+pid=%{INT:audit_pid} comm=\"%{WORD:audit_comm}\" path=\"%{DATA:audit_path}\" dev=\"%{WORD:audit_dev}\" ino=%{INT:audit_ino} scontext=%{DATA:audit_scontext} tcontext=%{DATA:audit_tcontext} tclass=%{WORD:audit_tclass}
AUDITD_7 avc:\s+%{WORD:audit_avcaction}\s+\{ %{WORD:audit_avcop} \} for\s+pid=%{INT:audit_pid} comm=\"%{WORD:audit_comm}\" capability=%{INT:audit_capability}\s+scontext=%{DATA:audit_scontext} tcontext=%{DATA:audit_tcontext} tclass=%{WORD:audit_tclass}
AUDITD_8 avc:\s+%{WORD:audit_avcaction}\s+\{ %{WORD:audit_avcop} \} for\s+pid=%{INT:audit_pid} comm=\"%{WORD:audit_comm}\" name=\"%{DATA:audit_name}\" scontext=%{DATA:audit_scontext} tcontext=%{DATA:audit_tcontext} tclass=%{WORD:audit_tclass}
AUDITD_25 avc:\s+%{WORD:audit_avcaction}\s+\{ %{WORD:audit_avcop} \} for\s+pid=%{INT:audit_pid} comm=\"%{WORD:audit_comm}\" name=\"%{DATA:audit_name}\" dev=\"%{WORD:audit_dev}\" ino=%{INT:audit_ino} scontext=%{DATA:audit_scontext} tcontext=%{DATA:audit_tcontext} tclass=%{DATA:audit_tclass}
AUDITD_26 avc:\s+%{WORD:audit_avcaction}\s+\{ %{WORD:audit_avcop} \} for\s+pid=%{INT:audit_pid} comm=%{WORD:audit_comm} dest=%{INT:audit_dest}\s+scontext=%{DATA:audit_scontext} tcontext=%{DATA:audit_tcontext} tclass=%{WORD:audit_tclass}

### SERVICE_START, SERVICE_STOP
AUDITD_9 pid=%{NUMBER:audit_pid} uid=%{NUMBER:audit_uid} auid=%{NUMBER:audit_auid} ses=%{NUMBER:audit_ses}( subj=%{DATA:audit_subject})? msg=\' comm=%{DATA:audit_comm} exe=\"%{DATA:audit_exe}\" hostname=(?:%{IPORHOST:audit_hostname}|\?) addr=(?:%{IP:src_ip}|\?) terminal=(?<audit_terminal>%{TTY}|\?|cron) res=%{DATA:audit_res}\'

## CRYPTO_SESSION: TRIGGERED TO RECORD PARAMETERS SET DURING TLS SESSION ESTABLISHMENT
AUDITD_10 pid=%{INT:audit_pid} uid=%{INT:audit_uid} auid=%{INT:audit_auid} ses=%{INT:audit_ses}( subj=%{DATA:audit_subject})? msg=\'op=%{DATA:audit_op} direction=%{DATA:audit_direction} cipher=%{DATA:audit_cipher} ksize=%{INT:audit_ksize} mac=%{DATA:audit_mac} pfs=%{DATA:audit_pfs} spid=%{INT:audit_spid} suid=%{INT:audit_suid} rport=%{INT:src_port} laddr=%{IP:dst_ip} lport=%{INT:dst_port}\s+exe=\"%{UNIXPATH:audit_exe}\" hostname=(?:%{IPORHOST:audit_hostname}|\?) addr=(?:%{IP:src_ip}|\?) terminal=(?<audit_terminal>%{TTY}|\?|cron) res=%{DATA:audit_res}\'

## USER_LOGIN, USER_LOGOUT, USER_CHAUTHOK, USER_ERR
## ADD_USER, ADD_GROUP: TRIGGERED WHEN USER-SPACE USER ACCOUNT OR GROUP IS ADDED
## DEL_USER, DEL_GROUP: TRIGGERED WHEN USER-SPACE USER ACCOUNT OR GROUP IS DELETED
AUDITD_11 pid=%{NUMBER:audit_pid} uid=%{NUMBER:audit_uid} auid=%{NUMBER:audit_auid} ses=%{NUMBER:audit_ses}( subj=%{DATA:audit_subject})? msg=\'op=%{DATA:audit_op} id=%{INT:audit_id} exe=\"%{UNIXPATH:audit_exe}\" hostname=(?:%{IPORHOST:audit_hostname}|\?) addr=(?:%{IP:src_ip}|\?) terminal=(?<audit_terminal>%{TTY}|\?|cron) res=%{DATA:audit_res}\'
AUDITD_12 pid=%{NUMBER:audit_pid} uid=%{NUMBER:audit_uid} auid=%{NUMBER:audit_auid} ses=%{NUMBER:audit_ses}( subj=%{DATA:audit_subject})? msg=\'op=%{DATA:audit_op} acct=\"%{DATA:user}\" exe=\"%{UNIXPATH:audit_exe}\" hostname=(?:%{IPORHOST:audit_hostname}|\?) addr=(?:%{IP:src_ip}|\?) terminal=(?<audit_terminal>%{TTY}|\?|cron) res=%{DATA:audit_res}\'

### USER_ROLE_CHANGE
AUDITD_13 pid=%{NUMBER:audit_pid} uid=%{NUMBER:audit_uid} auid=%{NUMBER:audit_auid} ses=%{NUMBER:audit_ses}( subj=%{DATA:audit_subject})? msg=\'pam: default-context=%{DATA:audit_defaultcontext} selected-context=%{DATA:audit_selectedcontext} exe=\"%{DATA:audit_exe}\" hostname=(?:%{IPORHOST:audit_hostname}|\?) addr=(?:%{IP:src_ip}|\?) terminal=(?<audit_terminal>%{TTY}|\?|cron) res=%{DATA:audit_res}\'

## USER_CMD
AUDITD_14 pid=%{NUMBER:audit_pid} uid=%{NUMBER:audit_uid} auid=%{NUMBER:audit_auid} ses=%{NUMBER:audit_ses}( subj=%{DATA:audit_subject})? msg=\'cwd=%{UNIXPATH:audit_cwd} cmd=%{DATA:audit_cmd} terminal=(?<audit_terminal>%{TTY}|\?|cron) res=%{DATA:audit_res}\'

### USER_AVC
AUDITD_15 pid=%{NUMBER:audit_pid} uid=%{NUMBER:audit_uid} auid=%{NUMBER:audit_auid} ses=%{NUMBER:audit_ses}( subj=%{DATA:audit_subject})? msg=\'avc:\s+%{WORD:audit_avcaction}\s+\{ %{WORD:audit_avcop} \}\s+for auid=%{INT:audit_auid} uid=%{INT:audit_uid} gid=%{INT:audit_gid} path=\"%{DATA:audit_path}\" cmdline=\"%{DATA:audit_cmdline}\" scontext=%{DATA:audit_scontext} tcontext=%{DATA:audit_tcontext} tclass=%{WORD:audit_tclass}\s+exe=\"%{DATA:audit_exe}\" sauid=%{INT:audit_sauid} hostname=%{IPORHOST:audit_hostname} addr=(?:%{IP:src_ip}|\?) terminal=(?<audit_terminal>%{TTY}|\?|cron)\'
AUDITD_16 pid=%{NUMBER:audit_pid} uid=%{NUMBER:audit_uid} auid=%{NUMBER:audit_auid} ses=%{NUMBER:audit_ses}( subj=%{DATA:audit_subject})? msg=\'avc:\s+%{DATA:audit_avcmsg}\s+exe=\"%{DATA:audit_exe}\" sauid=%{INT:audit_sauid} hostname=%{IPORHOST:audit_hostname} addr=(?:%{IP:src_ip}|\?) terminal=(?<audit_terminal>%{TTY}|\?|cron)\'

### ANOM_PROMISCUOUS
AUDITD_17 dev=%{WORD:audit_dev} prom=%{INT:audit_prom} old_prom=%{INT:audit_oldprom} auid=%{INT:audit_auid} uid=%{INT:audit_uid} gid=%{INT:audit_gid} ses=%{INT:audit_ses}

### MAC_STATUS
AUDITD_18 enforcing=%{INT:audit_enforcing} old_enforcing=%{INT:audit_oldenforcing} auid=%{INT:audit_auid} ses=%{INT:audit_ses}

### ANON_ABEND
AUDITD_19 auid=%{NUMBER:audit_auid} uid=%{NUMBER:audit_uid} gid=%{INT:audit_gid} ses=%{INT:audit_ses}( subj=%{DATA:audit_subject})? pid=%{INT:audit_pid} comm=\"%{WORD:audit_comm}\" reason=\"%{DATA:audit_reason}\" sig=%{INT:audit_sig}

### USER_MGMT
AUDITD_20 pid=%{NUMBER:audit_pid} uid=%{NUMBER:audit_uid} auid=%{NUMBER:audit_auid} ses=%{NUMBER:audit_ses}( subj=%{DATA:audit_subject})? msg=\'op=%{DATA:audit_op} grp=\"%{WORD:audit_id}\" acct=\"%{DATA:user}\" exe=\"%{DATA:audit_exe}\" hostname=%{IPORHOST:audit_hostname} addr=(?:%{IP:src_ip}|\?) terminal=(?<audit_terminal>%{TTY}|\?|cron) res=%{DATA:audit_res}\'

### MAC_POLICY_LOADED
AUDITD_21 policy loaded auid=%{NUMBER:audit_auid} ses=%{NUMBER:audit_ses}

### EXECVE
AUDITD_22 argc=%{INT:audit_argc} a0=\"%{DATA:audit_a0}\"%{GREEDYDATA:audit_args}

### CWD
AUDITD_23 cwd=\"%{DATA:audit_cwd}\"

### PATH
AUDITD_24 item=%{INT:audit_item} name=\"?%{DATA:audit_name}\"? inode=%{INT:audit_inode} dev=%{DATA:audit_dev} mode=%{INT:audit_mode} ouid=%{INT:audit_ouid} ogid=%{INT:audit_ogid} rdev=%{DATA:audit_rdev} obj=%{DATA:audit_obj} nametype=%{WORD:audit_nametype}
